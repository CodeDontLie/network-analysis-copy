---
  title: "SNA Lab 4: Statistical Inference & Network Models"
  subtitle: "Test"
  author: "**Dr. Shaun Kellogg**"
  institute: "LASER Institute"
  date: '`r format(Sys.time(), "%B %d, %Y")`'
  output:
    xaringan::moon_reader:
      css:
       - default
       - css/laser.css
       - css/laser-fonts.css
      lib_dir: libs                        # creates directory for libraries
      seal: false                          # false: custom title slide
      nature:
        highlightStyle: default         # highlighting syntax for code
        highlightLines: true               # true: enables code line highlighting 
        highlightLanguage: ["r"]           # languages to highlight
        countIncrementalSlides: false      # false: disables counting of incremental slides
        ratio: "16:9"                      # 4:3 for standard size,16:9
        slideNumberFormat: |
         <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
         </div>
---
class: clear, title-slide, inverse, center, top, middle

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo=FALSE}
# then load all the relevant packages
pacman::p_load(pacman, knitr, tidyverse, readxl)
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r xaringanExtra-clipboard, echo=FALSE}
# these allow any code snippets to be copied to the clipboard so they 
# can be pasted easily
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
  ),
  rmarkdown::html_dependency_font_awesome()
)
```
```{r xaringan-extras, echo=FALSE}
xaringanExtra::use_tile_view()

```

# `r rmarkdown::metadata$title`
----
### `r rmarkdown::metadata$author`
### `r format(Sys.time(), "%B %d, %Y")`

---
# Agenda

.pull-left[
## Part 1: Core Concepts
### Inference in Networks
- Applications of Inference
- Questions & Models
- A Selection Model Example

]

.pull-right[

## Part 2: R Code-Along
#### Exponential Random Graph Models
- {statnet} Package
- Model Parameters
- Interpreting Outputs
]


???
- In previous labs we focused on ways in which different algorithms can be used to describe properties related to ego or complete networks. 
- In This chapter moves beyond these static snapshots and provides an introduction to the ways in which recent advances in inferential statistics can be used to make predictions from social network data and address the questions in the previous paragraph.
- Part 1 will focus on..
- Part 2 will focus on..   

---
# A Quick Refresher


.pull-left[
## Network Visualization
.center[
REPLACE THIS
<img src="img/nodes-edges.jpeg" height="350px"/>
]
]


.pull-right[
## Network Measures

- degree and betweeness **Centrality**

- **Reciprocity** in directed networks

- complete network, group, or neighborhood **Density**
]


???

- Recall that in previous labs we focused on ways in which data visualization and network measurement can be used to describe properties of complete networks, groups within a network, or even individual's place within a network.  
- Network visualizations like this sociogram of school and district leaders, for example, can be a very useful tool for showing what your network looks like and highlighting network properties. For example, just like with this network, sociograms are usually constructed in such a way so that actor that are more central to the network are place in the center of the graph. 
- Network Measures, on the other hand, help to describe mathematically what your network "looks like." 
- For example, measures of centrality can put a number on how much a network as whole centers around a handful of individuals, and which individuals are more central to the network.  
- In directed networks, measures of reciprocity can inform about the flow of information in a network or potential hierarchies in a network.  
- And measures of density, whether for a whole network, group, or even individual actors' "neighborhoods" can can help describe how well connected individuals are in a network. 


---
class: clear, inverse, middle, center

# Part 1: Core Concepts


Inference, Models, and Exemplar 

???

- In Part 1, we move beyond network visualization and measurement and learn how the evolution of statistical inference and models allow social network analysis to not just describe networks and their properties, but attempt to explain and make predictions about them. 
- We'll then take a close look at a study by Alan Daly and colleagues that illustrated how these statistical models for netowrk analysis can be used to gain insight into educational settings. 

---

#  Inference in Networks

.panelset[

.panel[.panel-name[Evolution]

.pull-left[### Aim of Inference
1. Examine "relationships"

1. Test hypotheses

1. Analyze change
]

.pull-right[### Obstacles to Overcome
1. Violation of assumptions

1. Conventional formulas

1. Network dynamism 
]
]

.panel[.panel-name[Permutations]

.pull-left[

- Matrices are rearranged over and over (even thousands of times!)

- Permutations are then compared to your observed data

- If network properties of interest occur often, likely due to chance.

]

.pull-right[
INSERT MATRIX
]
]


.panel[.panel-name[Applications]

1. Is there a relationship between the frequency of collaboration between school leaders and their discussion of confidential issues? 
2. Do school leaders prefer to collaborate with those with whom they have collaborated in the past? 
3. Does gender or some other individual attribute predicts confidential exchanges between school leaders, or does some previous relation have a stronger effect? 
4. Does collaboration between leaders explain one's level of trust in colleagues? 
5. Can we distinguish among different groups of school leaders based on how frequently they collaborate, and if so, are these groupings related to the level at which they work (school versus district)?

]

.panel[.panel-name[Discussion]

Think about a network you are a part of or may be interested in studying. What research question(s) might you ask about the following relationship between:  
- different types of ties
- actor attributes and ties
- network properties and actor attributes
- groups in the network

Record your response in the chat. 

]

]

???
## Evolution
### Aims of Inference
- note 
### Obstacles to Overcome
- note
## Permutations
- note


---
# Models in Networks

.panelset[


.panel[.panel-name[QAP]

*Is there a relationship between the frequency of collaboration between school leaders and how often they discuss issues of a confidential nature?*

.pull-left[
INSERT COLLABORATION GRAPH Y1
]


.pull-right[
INSERT CONFIDENTIAL EXCHANGES Y3
```{r node-list, echo=FALSE, message=FALSE, warning=FALSE}

```

]
]

.panel[.panel-name[MR-QAP]

*Do school leaders prefer to collaborate with those with whom they have collaborated in the past or with those that they have discussed confidential issues?*

INSERT OUTPUT TABLE 9.3


]


.panel[.panel-name[P1 & P-Star]

*Does gender or some other individual attribute predicts confidential exchanges between school leaders, or does some previous relation have a stronger effect?*

.pull-left[

INSERT NETWORK

]


.pull-right[
INSERT OUTPUT TABLE 9.4

]

]

.panel[.panel-name[Regression]

*Does collaboration between leaders explain one's level of trust in colleagues?*
.pull-left[

INSERT NETWORK

]


.pull-right[
INSERT Node LIST

]

]

.panel[.panel-name[Discuss]

Think about a network you are a part of or may be interested in studying. What research question(s) might you ask about the following relationship between:  
- different types of ties
- actor attributes and ties
- network properties and actor attributes
- groups in the network

Record your response in the chat. 
]

]

???
## QAP
- The quadratic assignment procedure developed by Hubert (1987) and Krackhardt (1987b) tests the null hypothesis of no correlation between the two networks and adjusts for this dependence between networks by repeatedly permuting the order of rows and columns of one of the networks while keeping the other network intact.
- It is useful, for example, in determining whether there is a relationship between collaboration among school leaders in year 1 and how often they engage in confidential exchanges in year 3. Or you could examine the relationship between how frequently school leaders turn to each other to discuss issues of a confidential nature in year 1 and collaboration in year 3.
- 



---
# A Research Exemplar

.panelset[

.panel[.panel-name[Context]

.pull-left[

This longitudinal case study **examines reform-related knowledge, advice, and innovation network structures** among administrators in a district under sanction for under-performance and engaging in district-wide reform efforts.
]

.pull-right[

.center[<img src="img/daly-net.jpeg" height="320px"/>]
]

]

.panel[.panel-name[Questions]

This study involves **quantifying and visualizing the ties and overall structure** of informal networks to answer the following research questions: 

1. In what ways have reform-related social networks between district and site leaders evolved **over a 2-year period**? 
2. How do district and school leaders perceive the evolution of the social networks and its **effect on the exchange of reform-related resources** within the district?
]

.panel[.panel-name[Data]
To answer RQ1, Daly and Finnigan administered **online survey consisting of network relations and demographic questions** asking participants to:
- select the administrators in the La Estasis network that they interact with for the purpose of **advise seeking, collaboration, confidential exchanges**,
- assess their relationships on a **5-point interaction scale** ranging from 1 (no interaction) to 5 (1 to 2 times a week).

]

.panel[.panel-name[Key Findings]

Ovearall, the findings from SNA and qualitative interviews indicate that over time: 
- Networks **increased the number of superficial interactions**.
- More frequent exchanges, however, remained unchanged. 
- The result was a centralized network structure.
]

]


.footnote[
Daly, A. et al. (2011). [The ebb and flow of social network ties between district leaders.](https://github.com/laser-institute/network-analysis/blob/main/lab-2/lit/daly-ebb-flow.pdf)
]

???

---
class: clear, inverse, middle, center

# part_2(R, code_along)

Network Packages, Objects, and Sociograms



---
# Load Packages

.panelset[

.panel[.panel-name[Load Libraries]

Let's start by creating a new R script and loading the following packages introduced in the previous lab:          

```{r load-libraries, message=TRUE, echo=TRUE, message=FALSE}
library(readxl)
library(tidyverse)
library(tidygraph)
library(ggraph)
library(statnet)
```


]

.panel[.panel-name[ergm 📦]

The {ergm} <img src="img/igraph.png" height="40px"/> package and its collection of network analysis tools provide:

- pain-free implementation of graph algorithms
- fast handling of large graphs, with millions of vertices and edges

Both {tidygraph} and {ggraph} used in the previous lab depend heavily on the {igraph} package. 

]


.panel[.panel-name[Your Turn]

Load the {ergm} package.

```{r, echo=FALSE, message=FALSE}
library(ergm)
library(statnet)
```

```{r load-igraph, echo=TRUE}
# YOUR CODE HERE


```

]

]

---

# Import Data   

.panelset[

.panel[.panel-name[Import Data]

Let's import two Excel files from the Social Network Analysis and Education companion site. year_1_collaboration.xlsx 

```{r import-data, echo=TRUE, message=FALSE}
year_1_collaboration <- read_excel("data/year_1_collaboration.xlsx", 
                                   col_names = FALSE)
```


]

.panel[.panel-name[Inspect Data]

In the corresponding line of your R script, take a look at the data file we just imported:

```{r inspect-data, echo=TRUE}
# ADD CODE BELOW
#
#

```


]

.panel[.panel-name[Discuss]

Think about the questions below and be prepared to share your response:              
1. What do you notice about this data? 
1. What do you wonder about this data?
1. Why do you think our originally valued edges have been reduced to 1's and 0's, or **dichotmoized**?

Type your response to one of these questions in the chat. 

]

.panel[.panel-name[Answer]

- This adjacency matrix reports on **"collaboration" ties among 43 school leaders** in year 1 of a three-year study. 

- This is **a directed valued (weighted) network** measured on five-point scale ranging from 0 to 4, with higher values indicating more frequent collaborations (1–2 times/week).
]
]

---
# Wrangle Data  

.panelset[


.panel[.panel-name[Network Objects]

Before we can begin analyzing our network data in R, we need to convert to a network class R object. Run the following code in your R script:

```{r wrangle-data, echo=TRUE, message=FALSE, warning=FALSE}

year_1_matrix <- as.matrix(year_1_collaboration)

rownames(year_1_matrix) <- 1:43

colnames(year_1_matrix) <- 1:43


year_1_network <- as_tbl_graph(year_1_matrix, directed = TRUE)

```


]

.panel[.panel-name[View Network]

In the corresponding line of your R script, type the name of network object we just created and run the code:

```{r view-netwok, echo=TRUE}
# ADD CODE BELOW
#
#

```


]

.panel[.panel-name[Discuss]

Think about the questions below:              

1. What size of the Year 1 collaboration network?
1. What else do you notice about this network?
1. What questions, if any, do have about this network?

Type your responses in the chat.

]


]



---

# Network Density 

.panelset[

.panel[.panel-name[Definition]

.pull-left[ In its simplest form,  network density is **the ratio of existing ties in a network to all possible ties** that could potentially exist, regardless of whether they do.
]

.pull-right[ .center[<img src="img/density.jpeg" height="150px"/>

Which of these two networks has a higher density?
]
 
]

]

.panel[.panel-name[Significance]
In education, dense networks have been associated with:   
- healthy learning communities   
- other
- other

For better or worse, **dense networks reinforce prevailing norms** and behaviors and insulate one from outside influences (Carolan, 2011). 

]

.panel[.panel-name[Implementation]
The {igraph} package has a simple `edge_density()` function for calculating network density. Let's apply to our `year_1_network`:

```{r density, echo=TRUE}
edge_density(year_1_network)
```

How would you interpret this measure?
]

.panel[.panel-name[Discuss]

.pull-left[We know there 82 edges in the Year 1 network (pictured right), but **how many possible edges** could there be?   

**Hint**: The number of all possible edges in a directed network is V(V-1) where V is the # of vertices.

<!-- How many possible edges if this were an undirected network? -->
] 

.pull-right[
```{r examine-density, strip.white=TRUE, echo=FALSE}
autograph(year_1_network) +
  theme_graph()
```
]
]
]



---

# Network Centralization 

.panelset[

.panel[.panel-name[Definition]

.pull-left[A key structural property of complete networks is the concept of centralization, or **the extent to which relations are focused on one or a small set of actors**. 
]

.pull-right[ .center[<img src="img/density.jpeg" height="150px"/>

Which of these two networks is more centralized?
]
 
]

]

.panel[.panel-name[Significance]

- A network's centralization affects the process through which resources traverse the network. 
- Central actors likely wield a disproportionate amount of influence on the network. 
- High centralization provides fewer actors with more power and control.

]

.panel[.panel-name[Implementation]

.pull-left[
The {igraph} package has a simple `edge_density()` function for calculating network density. 

Let's apply to our `year_1_network`:]

.pull-right[
```{r centrality, echo=TRUE}
centr_degree(year_1_network, mode = "all")
```

How would you interpret this measure?
]
]

.panel[.panel-name[Discuss]

.pull-left[We know there 82 edges in the Year 1 network (pictured right), but **how many possible edges** could there be?   

**Hint**: The number of all possible edges in a directed network is V(V-1) where V is the # of vertices.

<!-- How many possible edges if this were an undirect network? -->
] 

.pull-right[
```{r examine-centrality, strip.white=TRUE, echo=FALSE}
autograph(year_1_network) +
  theme_graph()
```
]
]
]

---

# Network Reciprocity 

.panelset[

.panel[.panel-name[Definition]

.pull-left[A key structural property of complete networks is the concept of centralization, or **the extent to which relations are focused on one or a small set of actors**

]

.pull-right[ .center[<img src="img/density.jpeg" height="150px"/>

Which of these two networks is more centralized?
]
 
]

]

.panel[.panel-name[Significance]
- This property is important because it reveals the direction through which resources such as help, advice, and support flow. 
- It also indicates the network's stability, as reciprocated ties tend to be more stable over time. 
- Networks with high reciprocity may be more “equal,” while those with lower reciprocity may be more hierarchical.

]

.panel[.panel-name[Implementation]

.pull-left[
At the network-level, reciprocity is a measure of the likelihood of vertices in a directed network to be mutually linked. The {igraph} package has a simple `reciprocity()` function for calculating network density. 

Let's apply to our `year_1_network`:]

.pull-right[
```{r reciprocity, echo=TRUE}
reciprocity(year_1_network)
```

]
]

.panel[.panel-name[Discuss]

- How would you interpret this measure? 
- What does it indicate about our network? 


]
]

---
# What's Next

.pull-left[
## Readings & Discussion

- Collection
- Management  
- Quality  
]

.pull-right[
## Case Study

- Density
- Centrality 
- Reciprocity

]





---
class: clear, center

## .font130[.center[**Thank you!**]]
<br/>
.center[<img style="border-radius: 80%;" src="img/kellogg.jpeg" height="200px"/><br/>**Dr. Shaun Kellogg**<br/><mailto:sbkellog@ncsu.edu>]
