---
  title: "SNA Lab 1: Statistical Inference & Network Models"
  subtitle: "Test"
  author: "**Dr. Shaun Kellogg**"
  institute: "LASER Institute"
  date: '`r format(Sys.time(), "%B %d, %Y")`'
  output:
    xaringan::moon_reader:
      css:
       - default
       - css/laser.css
       - css/laser-fonts.css
      lib_dir: libs                        # creates directory for libraries
      seal: false                          # false: custom title slide
      nature:
        highlightStyle: default         # highlighting syntax for code
        highlightLines: true               # true: enables code line highlighting 
        highlightLanguage: ["r"]           # languages to highlight
        countIncrementalSlides: false      # false: disables counting of incremental slides
        ratio: "16:9"                      # 4:3 for standard size,16:9
        slideNumberFormat: |
         <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
         </div>
---
class: clear, title-slide, inverse, center, top, middle

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo=FALSE}
# then load all the relevant packages
pacman::p_load(pacman, knitr, tidyverse, readxl)
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r xaringanExtra-clipboard, echo=FALSE}
# these allow any code snippets to be copied to the clipboard so they 
# can be pasted easily
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
  ),
  rmarkdown::html_dependency_font_awesome()
)
```
```{r xaringan-extras, echo=FALSE}
xaringanExtra::use_tile_view()

```

# `r rmarkdown::metadata$title`
----
### `r rmarkdown::metadata$author`
### `r format(Sys.time(), "%B %d, %Y")`

---
# Agenda

.pull-left[
## Part 1: Core Concepts
### Data Management
- Collection
- Storage 
- Visualization

]

.pull-right[

## Part 2: R Code-Along
#### Exponential Random Graph Models
- Inspect Data
- Create a Network
- Simple Sociograms
]


???

Recall that the key difference between data used in typical STEM Ed Research and data used for social network analysis is the focus on relationships between individual rather than the individual themselves. As a result, this presents some unique issues inherent in how we manage of social network data, as well as the measurements derived from this data. 

This workshop is divided into two parts. In Part I, we focus on data management, including how to collect and store network data, as well as approaches to help ensure the quality of the data we collect. In Part II, we take a quick look at a study by Alan Daly that illustrates some of these approaches, and will then learn about some basic network-level measures such as dessity, centrality, and reciprocity that are commonly used to describe our networks mathematically. 

---
# A Quick Refresher

### The four hallmarks of social network analysis: 
1. an emphasis on structuralism based on ties among actors;
2. firmly grounded in empirical data; 
3. the use of graphical imagery; 
4. is mathematically based.


???



---
class: clear, inverse, middle, center

# Part 1: Core Concepts


Data Collection, Storage, and Quality

---

# Data Collection

.panelset[

.panel[.panel-name[Specify Boundary]

How do you determine **who's in the network** that you will collect data about?    

- Actors occupy a specific **position** in a social structure (e.g., leaders in a district)
- Determined by participation in an **event** at specific time and place (e.g., attendees at an academic conference)
- Defined by a specific **relation** know to the research or actors themselves.


]

.panel[.panel-name[Define Ties]

.pull-left[

### Relationship & Strength
- Friendships (friend, best friend)
- Co-Author/Presenter (# of pubs)
- Assignment Partner
- Committee Members

]


.pull-right[

### Interactions & Frequency
- Online Discussion (# of replies/DMs)
- Support Seeking (how often)
- Confidential Exchanges
- Communications

]


]


.panel[.panel-name[Identify Source]

.pull-left[

### Archives
- Email Accounts
- Discussion Forums
- Social Network Platforms
- School Records 

]


.pull-right[

### Sociometric Instrument
- [Survey](https://ncsu.qualtrics.com/jfe/preview/SV_5w2Ayiu2UriAz3M?Q_CHL=preview&Q_SurveyVersionID=current) or Interview Protocol
- Nomination or Roster
- Binary or Ordinal
- Simple or Multiplex


]

]

.panel[.panel-name[Discuss]

Consider the following quesions about a network you may be interested in studying:
- What is the boundary of this network? 
- What relations within this network might be of interest to your research? 
- What attributes about actors in this network might you want to 
- How might you collect data about these actors and their relations? 

Record your response in the chat. 

]

]

???

Prior to data collection, there are a number of decisions research have to make regarding the boundary of the network, relations to capture, and means of collecting data. 

### Boundary Specification 
- Specifying answers the question: Where do you set the limits when collecting relational data when, in theory, there are no limits? I'm going to quickly run through three generic approaches to addressing this issue.
- The **positional approach** defines a set of actors that occupy a similar position in some social structure. For example, in the study we'll take a look at in a little bit, actors in the network of study consisted of school and district level leaders at a school district placed under sanction and undergoing major school reforms. 
- The **event-based approach** to specifying a network's boundary falls delineate a network's boundaries by selecting only those actors who participated in an “event” at a specific time and place. For example, you may be interested in observing fellow researchers participating in an academic conference or attendees at local board of education meetings. As opposed to positional approaches that focus on actors’ behavior or role, the criterion for inclusion through this approach is an event rooted in time and place.
-  The **relational approach** is typically used in egocentric studies, which we don't address here, either based on a researcher's knowledge about relations among a set of actors or relies on the actors themselves to nominate additional actors for inclusion. For example, I'm currently evaluating network of agricultural research networks and we compiled a master list of the networks involved then asked the PIs about these network to identify the actors invovled, or likely to be involved in research and training collaboration between the networks.


---
# Data Storage

.panelset[


.panel[.panel-name[Node-List]

.pull-left[

Consistent with typical data storage, node-lists often include:
- **Name or ID of nodes**
- Demographic info (gender, age) 
- Socio-economic info (job, income)
- Substantative info (grades)
- **Nominated alters**

]


.pull-right[

```{r node-list, echo=FALSE, message=FALSE, warning=FALSE}
dlt1_nodes <- read_csv("data/dlt1-nodes.csv")

dlt1_nodes |>
  head() |>
  select(UID, role1, experience, region) |>
  kable()
```

]


]

.panel[.panel-name[Edge-List]

.pull-left[

Radically different than typical data storage, edge-lists include:
- **ego and an alter**
- tie strength or frequency
- edge attributes (time, event, text)

]


.pull-right[

```{r edge-list, echo=FALSE, message=FALSE, warning=FALSE}
dlt1_edges <- read_csv("data/dlt1-edges.csv")

dlt1_edges |>
  head() |>
  select(Sender, Receiver, Timestamp) |>
  kable()
```

]


]


.panel[.panel-name[Adjacency Matrix]

.pull-left[

Also radically different, an adjacency matrix includes:
- Column for each actor
- Row for each actor
- A Value indicate the presence/strength of a relation 

]


.pull-right[

```{r adjaency-matrix, echo=FALSE, message=FALSE, warning=FALSE}

year_1_collaboration <- read_excel("data/year_1_collaboration.xlsx", 
                                   col_names = FALSE)

year_1_matrix <- as.matrix(year_1_collaboration)

rownames(year_1_matrix) <- 1:43

colnames(year_1_matrix) <- 1:43

year_1_matrix[1:8, 1:8]
```

]

]

.panel[.panel-name[Discuss]

Take a look at one of the newtwork datasets located [here](https://github.com/laser-institute/network-analysis/tree/main/lab-2/data) and consider the following:
- What format is this data set stored as? 
- What are some things you notice about this dataset? 
- What questions do you have about this dataset? 

]

]

???



---
# Data Visualization 

.panelset[

.panel[.panel-name[Nodes]

- **Node.** Nodes are frequently referred to as actors or vertices and typically illustrated by circles, but the shape, color and size can vary depening on what the researcher wants to illustrate abotu the data. 

]


.panel[.panel-name[Edges]

While research on construct validity is slim, and participant recall is suspect, **approaches to improve instrument validity** include:   

1. Focus on more stable relations, as opposed to ones that are time specific;
1.  Limit the number of alters one can nominate;
1.  Ask respondents to try to answer what the others would say;
1.  Consider observations or archival data (e.g. logs, student records). 


.panel[.panel-name[Direction]

.pull-left[ 
### Measurement Issues
1. Recall vs. Recognition 
1. Fixed- vs. Free-Choice (Quantity)
1. Ratings vs. Rankings (Intensity)
1. Missing Data

]


.pull-right[

### Possible Solutions
1. Use a roster if network size < 50
1. No consensus, consider both
1. Ranking if network size < 20
1. Avoid if possible ;) 


]

]

]

.panel[.panel-name[Discuss]

.pull-left[Consider the following **sociogram**, or network graph, that consists of 
- nodes and 
- edges representing 
- What might be some threats to the quality of your data? 
- How might you address or avoid these threats? 

Record your response in the chat.  ]

]

]

???

Similar to data we might typically collect about individual participants in our research, the quality of relational data also depends on reliability, validity, accuracy, and measurement error.

### Reliability
- Social network researchers can rely on several common reliability measures, including interobserver reliability, internal consistency reliability, and **test–retest reliability**. The latter, however, is the most commonly used. For example, we may ask a teacher nominates all those other teachers from whom he or she seeks advice about professional matters. The retest repeats the same (or similar) request at a later time. Highly correlated responses indicate high reliability.
- One thing to note when designing a network study or data collection instrument is that closer ties tend to be reported more reliably than weaker ones. 
- Also, for self-reported ties, reciprocated ties are more trustworthy than non reciprocated. For example, one study asking college students to report whom they spend time with found that only 58% recalled spending time with each other. 

### Validity

Sadly, there has not been a lot of research on the validity of measures of network concepts. This issue is especially relevant to data collected by participant recall. For example, a research may ask students to list five classmates with whom they study, but actual observed behavior may indicate something totally different.

Ways to improve validity include: 
- Focusing on more stable relations, as opposed to ones that are time specific. For example, asking a respondent to identify who one regularly studies with as opposed to asking who one studied with this past month might be the better option.
- Limit the number of people one can nominate in order to counteract a tendency to under/overreport the number of relations one has
- Follow up on respondents’ reports, or explicitly asking respondents to try to answer what the others would say as well as what they themselves think and tell respondents that some information may be confirmed with others.
- Avoid self-report data altogether. If you sources like public records, email, participation in social networking platforms, and school transcripts, you don't need to directly ask respondents to report on their network. Instead, the network is reconstructed from these records and a number of different relations can be captured. For example, using the public Facebook profiles of a set of students in the same school, it is possible to construct a network of who bullies whom, so long as you can precisely define how bullying is measured.


---
class: clear, inverse, middle, center

# part_2(R, code_along)

Network Packages, Objects, and Sociograms


---
# Data Source

.panelset[

.panel[.panel-name[Context]

.pull-left[

This longitudinal case study **examines reform-related knowledge, advice, and innovation network structures** among administrators in a district under sanction for under-performance and engaging in district-wide reform efforts.
]

.pull-right[

.center[<img src="img/daly-net.jpeg" height="320px"/>]
]

]

.panel[.panel-name[Questions]

This study involves **quantifying and visualizing the ties and overall structure** of informal networks to answer the following research questions: 

1. In what ways have reform-related social networks between district and site leaders evolved **over a 2-year period**? 
2. How do district and school leaders perceive the evolution of the social networks and its **effect on the exchange of reform-related resources** within the district?
]

.panel[.panel-name[Data]
To answer RQ1, Daly and Finnigan administered **online survey consisting of network relations and demographic questions** asking participants to:
- select the administrators in the La Estasis network that they interact with for the purpose of **advise seeking, collaboration, confidential exchanges**,
- assess their relationships on a **5-point interaction scale** ranging from 1 (no interaction) to 5 (1 to 2 times a week).

]

.panel[.panel-name[Key Findings]

Ovearall, the findings from SNA and qualitative interviews indicate that over time: 
- Networks **increased the number of superficial interactions**.
- More frequent exchanges, however, remained unchanged. 
- The result was a centralized network structure.
]

]


.footnote[
Daly, A. et al. (2011). [The ebb and flow of social network ties between district leaders.](https://github.com/laser-institute/network-analysis/blob/main/lab-2/lit/daly-ebb-flow.pdf)
]

???


---
# Load Packages

.panelset[

.panel[.panel-name[Load Libraries]

Let's start by creating a new R script and loading the following packages introduced in the previous lab:          

```{r load-libraries, message=TRUE, echo=TRUE, message=FALSE}
library(tidygraph)
library(ggraph)
library(readxl)
```


]

.panel[.panel-name[network packages 📦]

.pull-left[
.center[Network Management
<br>
<br>
<img src="img/tidygraph.png" height="200px"/> 
<br>
[tidygraph](https://tidygraph.data-imaginist.com/)
]]

.pull-right[
.center[Network Visualization
<br>
<br>
<img src="img/ggraph.png" height="200px"/> 
<br>
[ggraph](https://ggraph.data-imaginist.com/index.html)
]
]


]


.panel[.panel-name[Your Turn]

Load the {tidygraph} and {ggraph} packages.

```{r, echo=FALSE, message=FALSE}
library(igraph)
```

```{r load-igraph, echo=TRUE}
# YOUR CODE HERE
#
#
```

]

]

---

# Import Data   

.panelset[

.panel[.panel-name[Import Data]

Let's start by importing two Excel files that contain data about the nodes and the edges in our student friendship network:

```{r import-data, echo=TRUE, message=FALSE, eval=FALSE}
student_nodes <- read_excel("lab-1/data/student-attributes.xlsx")

student_edges <- read_excel("lab-1/data/student-edgelist.xlsx")
```


```{r real-data, echo=FALSE, message=FALSE, eval=TRUE}
student_edges <- read_excel("data/student-edgelist.xlsx")

student_nodes <- read_excel("data/student-attributes.xlsx")
```


]

.panel[.panel-name[Inspect Data]

Now let's take a look at the data file we just imported using the `View()` or other function of choice:

```{r inspect-data, echo=TRUE, eval=FALSE}
View(student_edges)

View(student_nodes)
```


]

.panel[.panel-name[Discuss]

Think about the questions below and be prepared to share your response:              
1. What do you think the rows and columns in each file represent? 
1. What about the values in each cell represent?
1. What else do you notice about the data? 
1. What questions do you have? 

]

]

---
# Tidy Graph  

.panelset[

.panel[.panel-name[tbl_graph( ) function]

The [`tbl_graph()`](https://tidygraph.data-imaginist.com/reference/tbl_graph.html) function creates a special network data structure for "tidy graph" manipulation and combines nodes and edges into a single R object. 

Run the following code in your R script:

```{r wrangle-data, echo=TRUE, message=FALSE, warning=FALSE}
student_network <- tbl_graph(edges = student_edges,
                             nodes = student_attributes, 
                             directed = TRUE) 
```


]

.panel[.panel-name[View Network]


Using your R script, type the name of network object we just created and run the code to produce the output on the next tab:

```{r view-netwok, echo=TRUE}
# ADD CODE BELOW
#
#

```
]

.panel[.panel-name[Output]


```{r, echo=FALSE}
student_network
```

]

.panel[.panel-name[Discuss]

Think about the questions below:              

1. What is size of the student-reported friendship network?
1. What else do you notice about this network?
1. What questions do have about this network summary?

]


]

---

# A Simple Sociogram

.panelset[

.panel[.panel-name[plot( )]

.pull-left[ 
The `plot()` function is base R's simple but limited solution for plotting graphs.

```{r, echo=TRUE, fig.show='hide'}
plot(student_network)
```

]

.center[
.pull-right[ 
```{r, echo=FALSE, out.width = '70%'}
plot(student_network)
```
]
]
 
]


.panel[.panel-name[autograph( )]
.pull-left[ 
The `autograph()` function is ggraph's simple but limited solution for plotting sociograms.

```{r, echo=TRUE, fig.show='hide'}
autograph(student_network)
```

]

.center[
.pull-right[ 
```{r, echo=FALSE, out.width = '70%'}
autograph(student_network)
```
]
]
]

.panel[.panel-name[Arguments]
.pull-left[ 
Both functions allow a small degree of customization, but are still limited.

```{r, echo=TRUE, fig.show='hide'}
autograph(student_network,
          node_label = id,
          node_colour = gender)
```

]

.center[
.pull-right[ 
```{r, echo=FALSE, out.width = '100%'}
autograph(student_network,
          node_label = id,
          node_colour = gender)
```
]
]
]

.panel[.panel-name[Discuss]
1. In what situations might these limited functions be useful? 
2. When might they inapropriate to use?

]
]



---

# Sophisticated Sociograms

.panelset[

.panel[.panel-name[Set Graph]

The `ggraph()` function is the first function required to build a sociogram. This function: 
1. takes care of setting up the plot object 
1. creates the layout based on specification provided.

Try running this function and see what happens:
```{r set-graph, echo=TRUE, fig.show='hide'}
ggraph(student_network)
```
]
 

.panel[.panel-name["Add" Nodes]

.pull-left[
Let's “add” nodes to our sociogram using the `+` operator and the `geom_node_point()` function:
```{r , echo=TRUE, fig.show='hide'}
ggraph(student_network) + 
  geom_node_point() 
```

]

.pull-right[
```{r, echo=FALSE, out.width = '85%'}
ggraph(student_network) + 
  geom_node_point() 
```

How would you interpret this measure?
]
]


.panel[.panel-name[Add Edges]

.pull-left[
Now let's “add” edges to our sociogram using the `+` operator and the `geom_node_point()` function:
```{r , echo=TRUE, fig.show='hide'}
ggraph(student_network) + 
  geom_node_point() + 
  geom_edge_link()
```

]

.pull-right[
```{r, echo=FALSE, out.width = '85%'}
ggraph(student_network) + 
  geom_node_point() + 
  geom_edge_link()
```

How would you interpret this measure?
]
]

.panel[.panel-name[Polish]

.pull-left[
<br>
<br>
The {ggraph} packages allows for some fairly sophisticated graphs:
]

.pull-right[
.center[
```{r, echo=FALSE, out.width ='88%'}
ggraph(student_network, layout = "stress") + 
  geom_edge_link(arrow = arrow(length = unit(1, 'mm')), 
                 end_cap = circle(3, 'mm'),
                 start_cap = circle(3, 'mm'),
                 alpha = .1) +
  geom_node_point(aes(size = local_size(),
                      color = gender)) +
  geom_node_text(aes(label = id),
                 repel=TRUE) +
  theme_graph()
```
]
]
]

.panel[.panel-name[Code]
With a fair bit of coding: 
```{r , echo=TRUE, fig.show='hide'}
ggraph(student_network, layout = "stress") + 
  geom_edge_link(arrow = arrow(length = unit(1, 'mm')), 
                 end_cap = circle(3, 'mm'),
                 start_cap = circle(3, 'mm'),
                 alpha = .1) +
  geom_node_point(aes(size = local_size(),
                      color = gender)) +
  geom_node_text(aes(label = id),
                 repel=TRUE) +
  theme_graph()
```
]

]


---
# What's Next

.pull-left[
## Essential Readings

- Reading 1: [Statistical Inference With Network Data](https://via.hypothes.is/https://drive.google.com/file/d/1-zf90wAZGm2uM7qX-2HoeWTLmxn2ndJz/view?usp=sharing)

- Reading 2: [Network Data and Statistical Models](https://via.hypothes.is/https://drive.google.com/file/d/104zBHOcZL0Nj1Snm2KR1QAKOk96dtZfH/view?usp=sharing)  

] 

.pull-right[
## Case Study

- SNA Case Study: [Who's Friends with Who in Middle School?](https://laser-institute.github.io/network-analysis/lab-4/sna-lab-4-case-key.html)

- Guiding Study: [The ebb and flow of social network ties between district leaders.](https://via.hypothes.is/https://drive.google.com/file/d/1RPDTFTGlYV5RfN1EflPS8f8o_7giVGhX/view?usp=sharing)

]

---
class: clear, center

## .font130[.center[**Thank you!**]]
<br/>
.center[<img style="border-radius: 80%;" src="img/kellogg.jpeg" height="200px"/><br/>**Dr. Shaun Kellogg**<br/><mailto:sbkellog@ncsu.edu>]
